"use strict";(self.webpackChunkn2_compile=self.webpackChunkn2_compile||[]).push([[60795],{99894:(e,t,r)=>{function i(){return new Float32Array(4)}function s(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function n(e,t,r,i){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s}function o(){return i()}function a(){return n(1,1,1,1)}function c(){return n(1,0,0,0)}function l(){return n(0,1,0,0)}function d(){return n(0,0,1,0)}function u(){return n(0,0,0,1)}r.d(t,{al:()=>n,d9:()=>s});const h=o(),p=a(),_=c(),f=l(),g=d(),y=u();Object.freeze(Object.defineProperty({__proto__:null,ONES:p,UNIT_W:y,UNIT_X:_,UNIT_Y:f,UNIT_Z:g,ZEROS:h,clone:s,create:i,createView:function(e,t){return new Float32Array(e,t,4)},fromValues:n,ones:a,unitW:u,unitX:c,unitY:l,unitZ:d,zeros:o},Symbol.toStringTag,{value:"Module"}))},87072:(e,t,r)=>{function i(e){const t=e.layer;return"floorInfo"in t&&t.floorInfo?.floorField&&"floors"in e.view?n(e.view.floors,t.floorInfo.floorField):null}function s(e,t){return"floorInfo"in t&&t.floorInfo?.floorField?n(e,t.floorInfo.floorField):null}function n(e,t){if(!e?.length)return null;const r=e.filter((e=>""!==e)).map((e=>`'${e}'`));return r.push("''"),`${t} IN (${r.join(",")}) OR ${t} IS NULL`}r.d(t,{c:()=>i,f:()=>s})},62815:(e,t,r)=>{r.d(t,{_:()=>te});var i=r(51995),s=r(86950),n=(r(93169),r(42537)),o=r(32035),a=r(12400),c=r(5986),l=r(74509),d=r(19093),u=r(99894),h=r(70444),p=r(95773),_=r(85981),f=r(40885),g=r(19182),y=r(62389),m=r(19265),v=r(70619),R=r(56529),S=r(39077),w=r(4760),b=r(58901);class E extends g.i{constructor(e){super(e),this._ray=(0,f.Ue)(),this._isWorldDown=!1,this._start=(0,a.Ue)(),this._end=(0,a.al)(1,0,0),this._width=1,this._color=(0,u.al)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,u.al)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=T.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=R.yD.OccludeAndTransparent,this._fadedExtensions=j,this._laserline=new y.W({view:this.view,isDecoration:e.isDecoration}),this.applyProperties(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,o.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,o.f)(this._end,e,this._end),(0,f.zk)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,o.j)(this._start,e)||((0,o.c)(this._start,e),(0,f.zk)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,o.j)(this._end,e)||((0,o.c)(this._end,e),(0,f.zk)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,d.a)(e,this._color)||((0,d.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,d.a)(e,this._innerColor)||((0,d.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){null!=e&&null!=this._stippleOffColor&&(0,d.a)(e,this._stippleOffColor)||(this._stippleOffColor=null!=e?(0,u.d9)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&null!=this._laserlineStyle&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===R.yD.OccludeAndTransparentStencil?R.yD.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=e??j,this.recreateGeometry()}_updateMaterial(){const{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){const t=new b.U(this.materialParameters),r=new Array;return this._createObject3DGeometry(t,e,r),{material:t,geometries:r,forEach:e=>{e(t),r.forEach(e)}}}_destroyExternalResources(e){e.geometries=[]}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,r){const i=this._createGeometry(e);r.push(i),t.addGeometry(i),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new b.U(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){const t=this._createGeometry(e);return this._updateVerticesDraped(t),new S.z(t)}_createGeometry(e){const t=this.extensionType===T.FADED,r=t?[(0,a.Ue)(),(0,a.Ue)(),(0,a.Ue)(),(0,a.Ue)()]:[(0,a.Ue)(),(0,a.Ue)()];return(0,v.rh)(e,r,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===T.FADED?this._updateLineSegmentFinite(O):this._updateLineSegmentInfinite(this._extensionType,O)}_updateLineSegmentFinite(e){return(0,_.zk)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const r=this.view.state.camera;switch((0,h.iL)(this._ray,x),e){case T.LINE:x.c0=-Number.MAX_VALUE;break;case T.RAY:case T.GROUND_RAY:{const e=this._ray.origin,t=this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground")??0,r=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&r<t&&(0,o.F)(x.ray.direction,x.ray.direction),this._extensionType===T.GROUND_RAY&&null!=t&&(x.c1=Math.abs(r-t));break}}if(!(0,p.zq)(r.frustum,x))return this._updateLineSegmentFinite(t);const i=(0,h.Ws)(x,C),s=(0,h.S$)(x,D);return(0,_.zk)(i,s,t)}_updateVertexAttributesObject3D(e,t){const r=e.geometries[0].getMutableAttribute(w.T.POSITION)?.data;if(!r)return;let i=0;for(const s of this._lineVertices(t))r[i++]=s[0],r[i++]=s[1],r[i++]=s[2];e.geometryVertexAttributeUpdated(e.geometries[0],w.T.POSITION)}_updateVertexAttributesDraped(e,t){const r=e.getMutableAttribute(w.T.POSITION)?.data;if(!r)return;let i=0;for(const s of this._lineVertices(t))r[i++]=s[0],r[i++]=s[1],r[i++]=m.gi;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===T.FADED?(yield(0,_.KU)(e,-this.fadedExtensions.start,C),yield(0,_.KU)(e,0,C),yield(0,_.KU)(e,1,C),yield(0,_.KU)(e,1+this.fadedExtensions.end,C)):(yield(0,_.KU)(e,0,C),yield(0,_.KU)(e,1,C))}}const x=(0,h.Ue)(),C=(0,a.Ue)(),D=(0,a.Ue)(),O=(0,_.Ue)();var T;!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(T||(T={}));const P=1/3,j={start:P,end:P};var G=r(94172),F=r(17842),M=r(13611),A=r(6644),L=r(55946);class V extends g.i{constructor(e){super(e),this._location=(0,a.Ue)(),this._direction=(0,a.al)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,u.al)(1,0,1,1),this._renderOccluded=R.yD.OccludeAndTransparent,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyObject3DResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}get location(){return this._location}set location(e){(0,o.j)(this._location,e)||((0,o.c)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){(0,o.j)(this._direction,e)||((0,o.c)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){(0,o.n)(this._direction,(0,o.f)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){(0,d.a)(e,this._color)||((0,d.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){const t=new b.U(this.materialParameters),r=new Array;return this._createObject3DGeometry(t,e,r),{material:t,geometries:r,forEach:e=>{e(t),r.forEach(e)}}}_destroyObject3DResources(e){e.geometries.length=0}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,r){const[i,s]=this._createGeometries(e);t.addGeometry(i),t.addGeometry(s),r.push(i),r.push(s),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new b.U(this.materialParameters),t=(0,G.YP)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}));return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=this._createGeometries(e);return this._updateVerticesDraped(t),t.map((e=>new S.z(e)))}_createGeometries(e){return[(0,v.rh)(e,[(0,a.Ue)(),(0,a.Ue)()]),(0,v.rh)(e,[(0,a.Ue)(),(0,a.Ue)()])]}_updateMaterial(){const{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,H),(0,o.g)(I,this.location,this.direction),t.projectToScreen(I,q),(0,M.Fv)(q,(0,M.$X)(q,q,H)),this._updateVertexAttributesObject3D(t,e,0,H,q,1),this._updateVertexAttributesObject3D(t,e,1,H,q,-1)}_updateVertexAttributesObject3D(e,t,r,i,s,n){const o=t.geometries[r],a=o.getMutableAttribute(w.T.POSITION)?.data;if(!a)return;const{start:c,end:l}=this._computeStartEnd(s,i,n,this.offset,this.width,this.length);e.unprojectFromScreen((0,F.c$)(c),I),a[0]=I[0],a[1]=I[1],a[2]=I[2],e.unprojectFromScreen((0,F.c$)(l),I),a[3]=I[0],a[4]=I[1],a[5]=I[2],t.geometryVertexAttributeUpdated(o,w.T.POSITION)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:r}}}=this,{location:i,width:s,length:n,offset:o}=this,a=k;a.spatialReference=t.renderer.spatialReference,a.x=i[0],a.y=i[1];const c=this.view.overlayPixelSizeInMapUnits(a)*r,l=s*c,d=n*c,u=o*c;this._updateVertexAttributesDraped(e[0],l,d,u,-1),this._updateVertexAttributesDraped(e[1],l,d,u,1)}_updateVertexAttributesDraped(e,t,r,i,s){const n=e.getMutableAttribute(w.T.POSITION)?.data;if(!n)return;const{location:o,direction:a}=this,{start:c,end:l}=this._computeStartEnd(a,o,s,i,t,r);n[0]=c[0],n[1]=c[1],n[2]=m.gi,n[3]=l[0],n[4]=l[1],n[5]=m.gi,e.invalidateBoundingInfo()}_computeStartEnd(e,t,r,i,s,n){const o=(0,M.bA)(U,(0,M.t8)(U,e[1]*r,e[0]*-r),i+s/2),a=(0,M.IH)(z,(0,M.IH)(z,(0,M.IH)(z,t,(0,M.bA)(z,e,n/2)),o),o);return{start:a,end:(0,M.IH)(N,a,(0,M.bA)(N,e,-n))}}}const I=(0,a.Ue)(),U=(0,A.Ue)(),z=(0,A.Ue)(),N=(0,A.Ue)(),H=(0,F.s1)(),q=(0,F.s1)(),k=(0,L.T)(0,0,void 0,null);var Z=r(66730),W=r(98917),B=r(26279),Y=r(38054),X=r(76014),$=r(80371),K=r(34356),Q=r(38561),J=r(53397),ee=r(11208);class te extends Q.a{sortUniqueHints(e){return e.sort(((e,t)=>(t instanceof J.w?t.length:0)-(e instanceof J.w?e.length:0)))}visualizeIntersectionPoint(e,t){const{spatialReference:r,view:i}=t,s=re(t);return(0,n.ed)(new Z.L({view:i,primitive:"circle",geometry:(0,Y.Ju)(e.intersectionPoint,r),elevationInfo:e.isDraped?l.tR:l.jG,size:20,outlineSize:2,color:s.intersectionPointColor,outlineColor:s.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,t){const{view:r,spatialReference:i}=t,s=re(t),o=ie(e.point,e.domain,t);return(0,n.ed)(new Z.L({view:r,primitive:"circle",geometry:(0,Y.Ju)(o,i),elevationInfo:se(e,t),size:20,outlineSize:2,color:s.pointColor,outlineColor:s.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,t){const{view:r,spatialReference:i}=t,s=re(t),o=ie(e.lineStart,e.domain,t),a=ie(e.lineEnd,e.domain,t);return(0,n.ed)(this._createLineSegmentHint(e.type,o,a,i,se(e,t),r,s,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:r,spatialReference:i}=t,s=re(t),{isDraped:a}=e,c=se(e,t),l=ie(e.lineStart,e.domain,t),d=ie(e.lineEnd,e.domain,t),u=oe(l,i,c,r,a),h=oe(d,i,c,r,a),p=(0,o.m)(h,u,h,.5),_=new V({view:r,attached:!1,offset:X.c.parallelLineHintOffset,length:X.c.parallelLineHintLength,width:X.c.parallelLineHintWidth,color:s.parallelSignColor,location:p,renderOccluded:a?R.yD.OccludeAndTransparent:R.yD.Opaque,isDraped:a,renderGroup:B.eZ.SnappingHint,isDecoration:!0});return _.setDirectionFromPoints(u,p),_.attached=!0,(0,n.ed)(_)}visualizeRightAngleQuad(e,t){const{view:r,spatialReference:i}=t,s=re(t),o=se(e,t),{isDraped:a}=e,c=ie(e.previousVertex,e.domain,t),l=ie(e.centerVertex,e.domain,t),d=ie(e.nextVertex,e.domain,t),u=oe(c,i,o,r,a),h=oe(l,i,o,r,a),p=oe(d,i,o,r,a);return(0,n.ed)(new W.R({view:r,attached:!0,color:a?s.rightAngleColorDraped:s.rightAngleColor,renderOccluded:a?R.yD.OccludeAndTransparent:R.yD.Transparent,outlineRenderOccluded:a?R.yD.OccludeAndTransparent:R.yD.Opaque,outlineColor:s.rightAngleOutlineColor,outlineSize:X.c.rightAngleHintOutlineSize,size:X.c.rightAngleHintSize,isDraped:a,geometry:{previous:u,center:h,next:p},renderGroup:B.eZ.SnappingHint,isDecoration:!0}))}_createLineSegmentHint(e,t,r,i,s,n,o){let a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],l=!(arguments.length>9&&void 0!==arguments[9])||arguments[9];const d=oe(t,i,s,n,a),u=oe(r,i,s,n,a),h=new E({view:n,extensionType:T.FADED,start:d,end:u,isDraped:a,color:o.lineColor,renderOccluded:a?R.yD.OccludeAndTransparent:R.yD.Opaque,renderGroup:B.eZ.SnappingHint,isDecoration:!0});switch(e){case K.ze.TARGET:h.width=X.c.lineHintWidthTarget,h.fadedExtensions={start:0,end:X.c.lineHintFadedExtensions};break;case K.ze.REFERENCE_EXTENSION:h.width=X.c.lineHintWidthReference,h.fadedExtensions={start:0,end:0};break;case K.ze.REFERENCE:h.width=X.c.lineHintWidthReference,h.fadedExtensions={start:c?X.c.lineHintFadedExtensions:0,end:l?X.c.lineHintFadedExtensions:0}}return h.attached=!0,h}}function re(e){const{effectiveTheme:t}=e.view,r=i.Z.toUnitRGBA(t.accentColor),n=[0,0,0,0];return{intersectionPointColor:n,intersectionPointOutlineColor:r,pointColor:n,pointOutlineColor:r,lineColor:r,lineOutlineColor:void 0,parallelSignColor:r,rightAngleColor:r,rightAngleColorDraped:i.Z.toUnitRGBA((0,s.G)(t.accentColor,.5)),rightAngleOutlineColor:r}}function ie(e,t,r){const i=ne(t,r);return null==i?e:(0,Y.Ue)(e[0],e[1],i)}function se(e,t){return null!=ne(e.domain,t)?t.selfSnappingZ.elevationInfo:e.isDraped?l.tR:l.jG}function ne(e,t){let{selfSnappingZ:r}=t;return e===$.B.SELF&&null!=r?r.value:null}function oe(e,t,r,i,s){const n=(0,a.Ue)();if(s){const r=i.basemapTerrain.overlayManager.renderer.spatialReference;(0,c.S)(e,t,n,r)}else(0,ee.RS)(e,t,r,i,n);return n}},51328:(e,t,r)=>{r.d(t,{J4:()=>g,_N:()=>_,cx:()=>i,gv:()=>y});r(59486);var i,s=r(17842),n=(r(32035),r(12400)),o=(r(79803),r(55652)),a=r(40885),c=(r(40927),r(51378)),l=(r(74509),r(81703)),d=r(88153),u=r(54463),h=r(76783),p=(r(5693),r(585));function _(e,t){return f(e,(()=>t))}function f(e,t){const r=(0,n.Ue)(),i=(0,n.Ue)();let a=!1;return n=>{const d=t(n);if("start"===n.action){const t=(0,s.md)(n.screenStart,(0,s.c$)(c.qW.get())),i=(0,l.u4)(e.state.camera,t,m);null!=i&&(a=(0,o.BR)(d,i,r))}if(!a)return null;const u=(0,s.md)(n.screenEnd,(0,s.c$)(c.qW.get())),h=(0,l.u4)(e.state.camera,u,m);return null==h?null:(0,o.BR)(d,h,i)?{...n,renderStart:r,renderEnd:i,plane:d,ray:h}:null}}function g(e){let t=null;return r=>{switch(r.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":null!=t&&(t.remove(),t=null)}return r}}function y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r=(0,d.Z8)(e.state.viewingMode);r.options.selectionMode=!0,r.options.store=u.eC.MIN,r.options.hud=!1;const o=(0,s.s1)(),a={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},c=(0,n.Ue)(),l=t??e.spatialReference,_=t=>{e.map.ground&&e.map.ground.opacity<1?a.exclude.add(h.xX):a.exclude.delete(h.xX),e.sceneIntersectionHelper.intersectIntersectorScreen((0,s.md)(t,o),r,a);const n=r.results.min;let d;if(n.getIntersectionPoint(c))d=n.intersector===u.q7.TERRAIN?i.GROUND:i.OTHER;else{if(!r.results.ground.getIntersectionPoint(c))return null;d=i.GROUND}return{location:e.renderCoordsHelper.fromRenderCoords(c,new p.Z({spatialReference:l})),surfaceType:d}};let f;return e=>{if("start"===e.action){const t=_(e.screenStart);f=null!=t?t.location:null}if(null==f)return null;const t=_(e.screenEnd);return null!=t?.location?{...e,mapStart:f,mapEnd:t.location,surfaceType:t.surfaceType}:null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(i||(i={}));(0,n.Ue)(),(0,n.Ue)();const m=(0,a.Ue)()},19182:(e,t,r)=>{r.d(t,{i:()=>v});var i=r(27366),s=r(7138),n=r(79056),o=r(49861),a=(r(93169),r(32718),r(84936),r(69912)),c=r(26279),l=r(78289),d=r(78485);class u{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=c.eZ.Outline}destroy(){this._destroyResources()}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){this._renderGroup=e;const t=this._resources?.layerView;t&&(t.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory.createResources(),t=new h({view:this._resourceFactory.view,renderGroup:this._renderGroup}),r=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:new h({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:e,geometriesAdded:!1},r&&(this._resources.drapeSourceRenderer=r.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const e=this._resourceFactory.view.basemapTerrain?.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){null!=this._resources?.drapeSourceRenderer&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,l.T.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){null!=this._resources?.drapeSourceRenderer&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,l.T.UPDATE),this._resources.geometriesAdded=!0))}}let h=class extends((0,n.IG)(s.Z)){constructor(e){super(e),this.drapeSourceType=c.Lw.Features,this.updatePolicy=d.j.SYNC,this.renderGroup=c.eZ.Outline}};(0,i._)([(0,o.Cb)({constructOnly:!0})],h.prototype,"view",void 0),(0,i._)([(0,o.Cb)({readOnly:!0})],h.prototype,"drapeSourceType",void 0),(0,i._)([(0,o.Cb)()],h.prototype,"renderGroup",void 0),h=(0,i._)([(0,a.j)("DrapedVisualElementLayerView")],h);var p=r(86244),_=r(94172),f=r(79100),g=r(66327),y=r(97882);class m{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if(null==this._resources||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{t.type!==f.U.Mesh&&t.type!==f.U.Line&&t.type!==f.U.Point||e.remove(t)})),t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer),this._resources.external.forEach((t=>{t.type!==f.U.Mesh&&t.type!==f.U.Line&&t.type!==f.U.Point||e.add(t)}))}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,r=t._stage;if(!r)return;const i=new y.F(r,{pickable:!1,updatePolicy:d.j.SYNC}),s=new g.T({castShadow:!1}),n=e.createResources(s,i);n.forEach((e=>{r.add(e),e.type===f.U.Texture&&e.load(r.renderView.renderingContext)})),r.add(s),i.add(s);const o=e.cameraChanged,a=o?(0,_.YP)((()=>t.state.camera),(e=>o(e)),_.nn):null;this._resources={layer:i,object:s,external:n,cameraHandle:a},this._syncVisible()}_destroyResources(){if(null==this._resources)return;const e=this._resourceFactory.view._stage;e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this._resources.external.forEach((t=>{e.remove(t),t.type===f.U.Texture&&t.unload()}))),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class v extends p.l{constructor(e){super(e),this._isDraped=!1,this.object3dResources=new m(this.createObject3DResourceFactory(e.view)),this.drapedResources=new u(this.createDrapedResourceFactory(e.view)),this.isDraped=e.isDraped??!1}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}}},98917:(e,t,r)=>{r.d(t,{R:()=>w});var i=r(94172),s=r(29134),n=r(7025),o=r(32035),a=r(12400),c=r(19093),l=r(86361),d=r(51378),u=r(55946),h=r(19182),p=r(19265),_=r(91526),f=r(40779),g=r(70619),y=r(56529),m=r(39077),v=r(4760),R=r(66832),S=r(58901);class w extends h.i{constructor(e){super(e),this._maxSize=0,this._position=(0,a.Ue)(),this._up=(0,a.Ue)(),this._right=(0,a.Ue)(),this._renderOccluded=y.yD.OccludeAndTransparent,this._color=(0,l.al)(1,0,0,1),this._outlineColor=(0,l.al)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=y.yD.Opaque,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e)}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,c.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,c.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry(e){let{previous:t,center:r,next:i}=e;this._maxSize=Math.min((0,o.q)(r,t),(0,o.q)(r,i))/3,(0,o.n)(this._up,(0,o.f)(this._up,t,r)),(0,o.n)(this._right,(0,o.f)(this._right,i,r)),(0,o.c)(this._position,r),this.recreateGeometry()}_createObject3DResources(e){const t=new R.E(this._quadMaterialParameters),r=0===this._outlineSize?void 0:new S.U(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,r),{quadMaterial:t,outlineMaterial:r,forEach:e=>{e(t),r&&e(r)}}}_createObject3DGeometries(e,t,r){if((0,o.j)(this._up,a.AG)&&(0,o.j)(this._right,a.AG))return;const i=this._createGeometries(t,r);for(const s of i)e.addGeometry(s);this._updateTransformObject3D(e)}_createDrapedResources(){const e=new R.E(this._quadMaterialParameters),t=0===this._outlineSize?void 0:new S.U(this._outlineMaterialParameters),r=this._createGeometries(e,t).map((e=>new m.z(e)));return this._setTransformDraped(r),{quadMaterial:e,outlineMaterial:t,geometries:r,pixelRatioHandle:(0,i.YP)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}))}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_createGeometries(e,t){const{up:r,right:i,corner:s}=this._getVertices(),n=this._quadGeometryData(r,i,s,e);return t?[n,(0,g.rh)(t,[r,s,i])]:[n]}_getVertices(){let e=this._up,t=this._right;const r=(0,o.g)(d.WM.get(),e,t);return this.isDraped&&(e=(0,o.c)(d.WM.get(),e),t=(0,o.c)(d.WM.get(),t),e[2]=0,t[2]=0,r[2]=0),{up:e,right:t,corner:r}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object3dResources.object;if(!e)return;const t=this.view.state.camera,r=this._size*t.computeScreenPixelSizeAt(this._position),i=Math.min(this._maxSize,r);(0,s.vc)(b,this._position),(0,s.bA)(b,b,[i,i,i]),e.transformation=b}_setTransformDraped(e){if(0===e.length)return;const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:r}}}=this,{_position:i,_size:n}=this,a=(0,o.c)(d.WM.get(),i);a[2]=p.gi;const c=E;c.spatialReference=t.renderer.spatialReference,c.x=a[0],c.y=a[1];const l=n*(this.view.overlayPixelSizeInMapUnits(c)*r),u=Math.min(this._maxSize,l);(0,s.vc)(b,a),(0,s.bA)(b,b,[u,u,1]);for(const s of e)s.transformation=b}_quadGeometryData(e,t,r,i){return new f.Z(i,[[v.T.POSITION,new _.a([0,0,0,...t,...e,...r],[0,1,2,1,2,3],3,!0)]])}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){this.object3dResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters),this.drapedResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){this.object3dResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters),this.drapedResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters)}}const b=(0,n.Ue)(),E=(0,u.T)(0,0,void 0,null)},69763:(e,t,r)=>{r.d(t,{u:()=>je});var i=r(42537),s=r(70758),n=r(80987),o=r(94172),a=r(27366),c=r(7138),l=r(49861),d=(r(93169),r(32718)),u=(r(84936),r(69912));let h=class extends c.Z{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new n.Z}};(0,a._)([(0,l.Cb)({constructOnly:!0})],h.prototype,"layer",void 0),(0,a._)([(0,l.Cb)()],h.prototype,"enabled",void 0),(0,a._)([(0,l.Cb)()],h.prototype,"updating",void 0),(0,a._)([(0,l.Cb)()],h.prototype,"availability",void 0),(0,a._)([(0,l.Cb)()],h.prototype,"sublayerSources",void 0),h=(0,a._)([(0,u.j)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],h);const p=h;var _=r(76014),f=r(63780);let g=class extends c.Z{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new n.Z,this.distance=_.c.distance,this.touchSensitivityMultiplier=_.c.touchSensitivityMultiplier,this.constraintsActive=!1}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const e=this.featureSources;e.some(m)&&d.Z.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const t=e.filter(R),r=this._get("_effectiveFeatureSources")?.filter(m)??new n.Z;for(const n of t){const e=r.find((e=>e.layer===n.layer.parent));if(e)e.sublayerSources.includes(n)||e.sublayerSources.add(n);else if(n.layer.parent){const e=new p({layer:n.layer.parent});e.sublayerSources.add(n),r.add(e)}}for(const n of r){const e=n.sublayerSources.filter((e=>!t.includes(e)));n.sublayerSources.removeMany(e)}r.removeMany(r.filter((e=>0===e.sublayerSources.length)));const i=e.filter(v),s=this._get("_effectiveFeatureSources")??new n.Z,{added:o,removed:a}=(0,f.e5)(s.toArray(),[...i,...r]);return s.removeMany(a),s.addMany(o),s}};(0,a._)([(0,l.Cb)()],g.prototype,"enabled",void 0),(0,a._)([(0,l.Cb)()],g.prototype,"enabledToggled",void 0),(0,a._)([(0,l.Cb)()],g.prototype,"forceDisabled",void 0),(0,a._)([(0,l.Cb)()],g.prototype,"selfEnabled",void 0),(0,a._)([(0,l.Cb)()],g.prototype,"featureEnabled",void 0),(0,a._)([(0,l.Cb)({type:n.Z.ofType(p)})],g.prototype,"featureSources",void 0),(0,a._)([(0,l.Cb)()],g.prototype,"distance",void 0),(0,a._)([(0,l.Cb)()],g.prototype,"touchSensitivityMultiplier",void 0),(0,a._)([(0,l.Cb)()],g.prototype,"constraintsActive",void 0),(0,a._)([(0,l.Cb)({readOnly:!0})],g.prototype,"effectiveEnabled",null),(0,a._)([(0,l.Cb)({readOnly:!0})],g.prototype,"effectiveSelfEnabled",null),(0,a._)([(0,l.Cb)({readOnly:!0})],g.prototype,"effectiveFeatureEnabled",null),(0,a._)([(0,l.Cb)({readOnly:!0})],g.prototype,"_effectiveFeatureSources",null),g=(0,a._)([(0,u.j)("esri.views.interactive.snapping.SnappingOptions")],g);const y=g;function m(e){return"subtype-group"===e.layer.type}function v(e){return"subtype-group"!==e.layer.type}function R(e){return"subtype-sublayer"===e.layer.type}var S=r(66978),w=r(68860),b=r(13611),E=r(32035),x=r(12400),C=r(24204),D=r(46634),O=r(74509),T=r(44179),P=r(38054),j=r(76672),G=r(18661),F=r(87072),M=r(37933),A=r(34356),L=r(69787);let V=class extends c.Z{get layerView(){return this.view?.allLayerViews?.find((e=>e.layer===this.layer))}get valid(){return this._valid}get subtypeFilter(){const{layer:e,snappingSource:t}=this;if(!(0,M.e9)(e)||!e.subtypes?.length)return{mode:"not-in-use",filter:null};const r=t.layerSource.sublayerSources.filter((e=>e.enabled&&e.layer.visible&&(0,L.rs)(this.view?.scale,e.layer.effectiveScaleRange.minScale,e.layer.effectiveScaleRange.maxScale))).map((e=>e.layer.subtypeCode));if(!r.length)return{mode:"none-visible",filter:null};if(r.length===e.subtypes.length)return{mode:"all-visible",filter:null};const i=e.fieldsIndex.get(e.subtypeField)?.name??e.subtypeField;return 1===r.length?{mode:"in-use",filter:`${i} = ${r.getItemAt(0)}`}:{mode:"in-use",filter:`${i} IN (${r.join(", ")})`}}get floorFilter(){const{view:e,layer:t}=this;return e&&t?(0,F.c)({view:e,layer:t}):null}constructor(e){super(e),this.rulesTable=null,this._valid=!1}initialize(){if(!this.snappingSource||!this.layer)return;const{layer:e,snappingSource:t}=this;if("refresh"in e){const r=e;this.addHandles(r.on("refresh",(()=>t.refresh())))}this.loadRules(),this.addHandles([(0,o.YP)((()=>t.updating),(e=>t.layerSource.updating=e),o.tX),(0,o.YP)((()=>t.availability),(e=>t.layerSource.availability=e),o.tX)])}getFetchCandidatesParameters(e,t,r){if(!this.valid)return[];const{layer:i,layerView:s,floorFilter:n,rulesTable:o,subtypeFilter:a}=this,c={distance:r,mode:this.view?.type??"2d",point:e,coordinateHelper:t.coordinateHelper,...this._types,filter:s&&"filter"in s?s.filter:null};if(n&&(c.filter=I(c.filter,n)),"not-in-use"!==a.mode&&"all-visible"!==a.mode){if("none-visible"===a.mode)return[];c.filter?c.filter.where=(0,j._)(c.filter.where,a.mode):c.filter=new G.Z({where:a.filter})}const l=t.feature,d="subtype-sublayer"===l?.sourceLayer?.type?l.sourceLayer.parent:l?.sourceLayer;if(o&&l&&(0,A.n0)(this.view?.map)&&((0,M.Te)(i)||(0,M.e9)(i))&&i.layerId&&((0,M.Te)(d)||(0,M.e9)(d))&&this.view.map.utilityNetworks?.find((e=>e.isUtilityLayer(d)))){if("loaded"!==o.loadStatus)return[];const e=[],t=i.layerId,r=o.getFeatureSQL(d,l)?.[t];if(!r)return[];const s=r.anyVertex;let n=r.endVertex;return n&&s&&n===s&&(n=""),n&&e.push({...c,returnEdge:!1,vertexMode:"ends",filter:I(c.filter,n)}),s&&e.push({...c,returnEdge:!1,vertexMode:"all",filter:I(c.filter,s)}),e}return[c]}async loadRules(){const{layer:e,view:t}=this;if(e&&t&&(0,A.n0)(t?.map)&&((0,M.Te)(e)||(0,M.e9)(e))){const r=t.map.utilityNetworks?.find((t=>t.isUtilityLayer(e)));if(r)try{this.rulesTable=await r.getRulesTable(),await(this.rulesTable?.load())}catch(h){return void d.Z.getLogger("esri.views.interactive.snapping.FeatureSnappingSourceInfo").error("Failed to load rules table for snapping source",e.title)}}this._valid=!0}get _types(){return{returnEdge:!0,vertexMode:"all"}}remove(){this.destroy()}destroy(){this.snappingSource?.destroy()}};function I(e,t){return null==e?new G.Z({where:t}):e.where?new G.Z({where:(0,j._)(e.where,t)}):new G.Z({where:t})}(0,a._)([(0,l.Cb)({constructOnly:!0})],V.prototype,"layer",void 0),(0,a._)([(0,l.Cb)({constructOnly:!0})],V.prototype,"snappingSource",void 0),(0,a._)([(0,l.Cb)({constructOnly:!0})],V.prototype,"view",void 0),(0,a._)([(0,l.Cb)()],V.prototype,"layerView",null),(0,a._)([(0,l.Cb)()],V.prototype,"rulesTable",void 0),(0,a._)([(0,l.Cb)()],V.prototype,"valid",null),(0,a._)([(0,l.Cb)()],V.prototype,"subtypeFilter",null),(0,a._)([(0,l.Cb)()],V.prototype,"floorFilter",null),(0,a._)([(0,l.Cb)()],V.prototype,"_valid",void 0),V=(0,a._)([(0,u.j)("esri.views.interactive.snapping.FeatureSnappingSourceInfo")],V);var U,z=r(80371),N=r(97760),H=r(95905),q=r(75691),k=r(92605),Z=r(53397),W=r(41216);class B extends k.j{constructor(e){let{targetPoint:t,constraint:r,previousVertex:i,otherVertex:s,otherVertexType:n,objectId:o,isDraped:a}=e;super(t,r,a,z.B.SELF),this.previousVertex=i,this.otherVertex=s,this.otherVertexType=n,this.objectId=o}get hints(){const e=this.previousVertex,t=this.otherVertexType===U.CENTER?this.otherVertex:this.targetPoint,r=this.otherVertexType===U.CENTER?this.targetPoint:this.otherVertex;return[new Z.w(A.ze.TARGET,t,r,this.isDraped,this.domain),new Z.w(A.ze.REFERENCE,e,t,this.isDraped,this.domain),new W.y(this.previousVertex,t,r,this.isDraped,this.domain)]}}!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(U||(U={}));var Y=r(11208);let X=class extends c.Z{get updating(){return this._snappingSources.some((e=>null==e||e.valid&&e.snappingSource.updating))||this._updatingHandles.updating}constructor(e){super(e),this.options=null,this._domain=z.B.FEATURE,this._updatingHandles=new D.R,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}initialize(){const e=(0,o.TP)((()=>this.options?._effectiveFeatureSources),((e,t)=>this._createSourceInfo(e,t)));this._snappingSources=e,this.addHandles((0,i.ed)(e))}destroy(){this._set("options",null),this._updatingHandles.destroy()}async fetchCandidates(e,t,r,i){if(!(t&this._domain&&null!=this.options&&this.options.effectiveFeatureEnabled))return[];const s=[],n=this._computeScreenSizeDistanceParameters(e,r);for(const a of this._snappingSources){if(null==a||!a.valid||!a.snappingSource.layerSource.enabled||a.layerView?.suspended)continue;const t=a.getFetchCandidatesParameters(e,r,n);for(const e of t)s.push(a.snappingSource.fetchCandidates(e,i).then((e=>e.filter((e=>!this._candidateIsExcluded(a.snappingSource,e,r.excludeFeature))))))}const o=(await(0,S.OT)(s)).flat();return this._addRightAngleCandidates(o,e,n,r),(0,S.k_)(i),(0,A.lQ)(e,o),o}_addRightAngleCandidates(e,t,r,i){const s=null!=i.vertexHandle?i.vertexHandle.rightEdge?.rightVertex?.pos:null!=i.editGeometryOperations&&"polygon"===i.editGeometryOperations.data.type?i.editGeometryOperations.data.components[0]?.getFirstVertex()?.pos:null,n=null!=i.vertexHandle?i.vertexHandle.leftEdge?.leftVertex?.pos:null!=i.editGeometryOperations?i.editGeometryOperations.data.components[0]?.getLastVertex()?.pos:null,{view:o}=this,a=(0,P.j7)(s,o,i),c=(0,P.j7)(n,o,i),l=e.length;for(let d=0;d<l;d++)this._addRightAngleCandidate(e[d],c,t,r,e),this._addRightAngleCandidate(e[d],a,t,r,e)}_addRightAngleCandidate(e,t,r,i,s){if(null==t||!function(e){return(e instanceof H.L||e instanceof N.k)&&!function(e){let{constraint:{start:t,end:r}}=e;const i=(0,E.a)(t,r),s=(0,b.bI)((0,P.eR)(t),(0,P.eR)(r));return i<(0,C.bn)()||s/i<J}(e)}(e))return;const n=e.constraint.closestTo(t),o=(n[0]-r[0])/i.x,a=(n[1]-r[1])/i.y,{start:c,end:l}=e.constraint;if(o*o+a*a<=1){const r=new B({targetPoint:n,otherVertex:t,otherVertexType:U.NEXT,previousVertex:(0,b.bI)((0,P.eR)(n),(0,P.eR)(c))>(0,b.bI)((0,P.eR)(n),(0,P.eR)(l))?c:l,constraint:new T.aU(t,n),objectId:e.objectId,isDraped:e.isDraped});s.push(r)}}_computeScreenSizeDistanceParameters(e,t){let r=null!=this.options?this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1):0;return null==this.view?{x:r,y:r,z:r,distance:r}:"2d"===this.view.type?(r*=this.view.resolution,{x:r,y:r,z:r,distance:r}):this._computeScreenSizeDistanceParameters3D(e,r,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,r,i){const{spatialReference:s}=i;r.renderCoordsHelper.toRenderCoords(e,s,K);const n=r.state.camera.computeScreenPixelSizeAt(K),o=n*r.renderCoordsHelper.unitInMeters,a=o/(0,w.c9)(s),c=o/(0,w._R)(s),l=t*a,d=t*c,u=(0,Y.Rs)(e,s,O.jG,r),h=u?$(u,e,a,0,0,r,i):0,p=u?$(u,e,0,a,0,r,i):0,_=u?$(u,e,0,0,c,r,i):0;return{x:0===h?0:l/h,y:0===p?0:l/p,z:0===_?0:d/_,distance:n*t}}_candidateIsExcluded(e,t,r){if(null==r)return!1;const i=this._getCandidateObjectId(t);if(null==i)return!1;const s=e.layerSource.layer;return"graphics"===s.type?r.uid===i:r.sourceLayer===s&&!(!r.attributes||!("objectIdField"in s))&&r.attributes[s.objectIdField]===i}_getCandidateObjectId(e){return e instanceof q.a?e.objectId:null}async _createSourceInfo(e,t){const r=e.layer;r.loaded||(await r.load(),(0,S.k_)(t));const{view:i}=this,s=await this._createFeatureSnappingSourceType(e);return(0,S.k_)(t),new V(null==s?{}:{snappingSource:s,view:i,layer:r})}async _createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}async _createFeatureSnappingSourceSceneLayer(e){const{view:t}=this;return null==t||"3d"!==t.type?null:new((await this._getSourceModule("scene")).SceneLayerSnappingSource)({layerSource:e,view:t})}async _createFeatureSnappingSourceFeatureLayer(e){switch(e.layer.source?.type){case"feature-layer":case"oriented-imagery":return new((await this._getSourceModule("featureService")).FeatureServiceSnappingSource)({spatialReference:this.spatialReference,view:this.view,layerSource:e});case"memory":case"csv":case"geojson":case"wfs":return"mesh"===e.layer.geometryType?null:new((await this._getSourceModule("featureCollection")).FeatureCollectionSnappingSource)({layerSource:e,view:this.view})}return null}async _createFeatureSnappingSourceGraphicsLayer(e){return new((await this._getSourceModule("graphics")).GraphicsSnappingSource)({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _createFeatureSnappingSourceMapNotesLayer(e){return new((await this._getSourceModule("notes")).GraphicsSnappingSource)({getGraphicsLayers:()=>e.layer.sublayers?.toArray()??[],spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _getSourceModule(e){const t=this._sourceModules[e];if(null==t.loader){const t=this._loadSourceModule(e),r={module:null,loader:t};this._sourceModules[e]=r;const i=await t,s={module:i,loader:t};return this._sourceModules[e]=s,i}return null==t.module?t.loader:t.module}_loadSourceModule(e){const t=this._updatingHandles;switch(e){case"featureService":return t.addPromise(r.e(5532).then(r.bind(r,5532)));case"featureCollection":return t.addPromise(r.e(26823).then(r.bind(r,26823)));case"graphics":case"notes":return t.addPromise(Promise.all([r.e(54054),r.e(45026),r.e(71486),r.e(14346),r.e(33518)]).then(r.bind(r,66540)));case"scene":return t.addPromise(r.e(92767).then(r.bind(r,92767)))}}get test(){return{snappingSources:this._snappingSources}}};function $(e,t,r,i,s,n,o){let{spatialReference:a}=o;const c=(0,E.c)(Q,t);c[0]+=r,c[1]+=i,c[2]+=s;const l=(0,Y.Rs)(c,a,O.jG,n);return l?(0,A.fG)(l,e):1/0}(0,a._)([(0,l.Cb)({constructOnly:!0})],X.prototype,"spatialReference",void 0),(0,a._)([(0,l.Cb)({constructOnly:!0})],X.prototype,"view",void 0),(0,a._)([(0,l.Cb)()],X.prototype,"options",void 0),(0,a._)([(0,l.Cb)({readOnly:!0})],X.prototype,"updating",null),(0,a._)([(0,l.Cb)()],X.prototype,"_snappingSources",void 0),X=(0,a._)([(0,u.j)("esri.views.interactive.snapping.FeatureSnappingEngine")],X);const K=(0,x.Ue)(),Q=(0,x.Ue)(),J=1e-4;var ee=r(91505),te=r(79803),re=r(17768),ie=r(47898);class se{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=_.c.shortLineThreshold*_.c.shortLineThreshold}snap(e,t){return null!=t.vertexHandle?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold((0,P.j7)(e.leftVertex.pos,this.view,t),(0,P.j7)(e.rightVertex.pos,this.view,t),t)}exceedsShortLineThreshold(e,t,r){let{spatialReference:i}=r;return 0===this.squaredShortLineThreshold||(0,A.Bb)((0,Y.Rs)(t,i,O.jG,this.view),(0,Y.Rs)(e,i,O.jG,this.view))>this.squaredShortLineThreshold}isVertical(e,t,r){let{spatialReference:i}=r;const s=(0,w.c9)(i);return(0,b.TE)((0,P.eR)(e),(0,P.eR)(t))*s<_.c.verticalLineThresholdMeters}squaredProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,r=e*t;return r*r}}class ne extends k.j{constructor(e){let{lineStart:t,lineEnd:r,targetPoint:i,isDraped:s}=e;super(i,new T.jg(t,r),s,z.B.SELF),this._referenceLineHint=new Z.w(A.ze.REFERENCE_EXTENSION,t,r,s,this.domain)}get hints(){return[this._referenceLineHint,new Z.w(A.ze.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}var oe=r(73840),ae=r(30541),ce=r(55793),le=r(94163);class de extends se{snapNewVertex(e,t){const r=t.editGeometryOperations.data.components[0],i=r.edges.length,s=[];if(i<1)return s;const{spatialReference:n}=t,o=(0,Y.Rs)(e,n,O.jG,this.view),{view:a}=this,c=r.edges[i-1];let l=c;do{if(this.edgeExceedsShortLineThreshold(l,t)){const r=(0,A._j)(l,a,t);this._processCandidateProposal(r.left,r.right,e,o,t,s)}l=l.leftVertex.leftEdge}while(l&&l!==c);return s}snapExistingVertex(e,t){const r=[],i=t.vertexHandle,s=i.component;if(s.edges.length<2)return r;const{view:n}=this,{spatialReference:o}=t,a=(0,Y.Rs)(e,o,O.jG,n),c=i.leftEdge,l=i.rightEdge;c&&l&&this.edgeExceedsShortLineThreshold(c,t)&&this.edgeExceedsShortLineThreshold(l,t)&&this._processCandidateProposal((0,P.j7)(c.leftVertex.pos,n,t),(0,P.j7)(l.rightVertex.pos,n,t),e,a,t,r);const d=s.edges[0];let u=d;do{if(u!==i.leftEdge&&u!==i.rightEdge&&this.edgeExceedsShortLineThreshold(u,t)){const i=(0,A._j)(u,n,t);this._processCandidateProposal(i.left,i.right,e,a,t,r)}u=u.rightVertex.rightEdge}while(u&&u!==d);return r}_processCandidateProposal(e,t,r,i,s,n){const{spatialReference:o,pointer:a}=s,c=(0,x.Ue)();this._projectedLine(c,e,t,r,s);const l=(0,P.uo)(c);(0,A.Bb)(i,(0,Y.Rs)(l,o,O.jG,this.view))<this.squaredProximityThreshold(a)&&n.push(new ne({lineStart:e,lineEnd:t,targetPoint:l,isDraped:"on-the-ground"===s.elevationInfo?.mode}))}_projectedLine(e,t,r,i,s){this._projectToLineGeodesic(e,t,r,i,s)||this._projectToLinePlanar(e,i,t,r)}_projectToLineGeodesic(e,t,r,i,s){let{spatialReference:n}=s;const o=(0,oe.n6)(t,r,n,n);if(null==o)return!1;const a=(0,oe.n6)(r,i,n,n);if(null==a)return!1;const c=(0,ae.FB)(r,i,n);if(null==c)return!1;const l=Math.abs(re.Q4.shortestSignedDiff(o,a))>Math.PI/2?re.c5.normalize(o+Math.PI):o;return(0,oe.LH)(e,r,n,(0,ie.mE)(c,"meters"),(0,ie.GJ)(l,"radians","geographic"),"geodesic"),e[2]=i[2],!0}_projectToLinePlanar(e,t,r,i){(0,ce.ZE)(t,{start:r,end:i,type:le.SP.LINE},e),e[2]=t[2]}}var ue=r(6644),he=r(5916);class pe extends k.j{constructor(e){let{referenceLine:t,lineStart:r,targetPoint:i,isDraped:s}=e;const n=(0,x.d9)(r),{left:o,right:a}=t;(0,E.f)(n,(0,E.g)(n,n,a),o),super(i,new T.jg(r,(0,P.uo)(n)),s,z.B.SELF),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new Z.w(A.ze.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new he.L(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map((e=>new Z.w(A.ze.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight)))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((r=>{(0,E.j)(e.right,r.edge.left)&&(r.fadeLeft=!1,t.fadeRight=!1),(0,E.j)(e.right,r.edge.right)&&(r.fadeRight=!1,t.fadeRight=!1),(0,E.j)(e.left,r.edge.right)&&(r.fadeRight=!1,t.fadeLeft=!1),(0,E.j)(e.left,r.edge.left)&&(r.fadeLeft=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}class _e extends se{snapNewVertex(e,t){const r=t.editGeometryOperations.data.components[0],i=r.edges.length,s=r.vertices.length,n=[];if(i<2)return n;const{view:o}=this,a=(0,Y.Rs)(e,t.spatialReference,O.jG,o),c=(0,P.j7)(r.vertices[s-1].pos,o,t),l=(0,P.j7)(r.vertices[0].pos,o,t),d=r.edges[i-1];let u=d;do{if(this.edgeExceedsShortLineThreshold(u,t)){const r=(0,A._j)(u,o,t);this._checkEdgeForParallelLines(r,c,e,a,t,n),this._checkEdgeForParallelLines(r,l,e,a,t,n)}u=u.leftVertex.leftEdge}while(u&&u!==d);return n}snapExistingVertex(e,t){const r=[],i=t.vertexHandle,s=i.component;if(s.edges.length<3)return r;const{view:n}=this,o=(0,Y.Rs)(e,t.spatialReference,O.jG,n),a=i.leftEdge,c=i.rightEdge,l=s.vertices[0],d=(0,P.j7)(l.pos,n,t),u=s.vertices.length,h=s.vertices[u-1],p=(0,P.j7)(h.pos,n,t),_=s.edges[0];let f=_;do{if(f!==a&&f!==c&&this.edgeExceedsShortLineThreshold(f,t)){const s=(0,A._j)(f,n,t);a&&this._checkEdgeForParallelLines(s,(0,P.j7)(a.leftVertex.pos,n,t),e,o,t,r),c&&this._checkEdgeForParallelLines(s,(0,P.j7)(c.rightVertex.pos,n,t),e,o,t,r),i===l?this._checkEdgeForParallelLines(s,p,e,o,t,r):i===h&&this._checkEdgeForParallelLines(s,d,e,o,t,r)}f=f.rightVertex.rightEdge}while(f&&f!==_);return r}_checkEdgeForParallelLines(e,t,r,i,s,n){const o=e.left,a=e.right;if((0,le.k0)(fe,(0,P.eR)(t),(0,P.eR)(o),(0,P.eR)(a)),(0,b.bI)(fe,(0,P.eR)(t))<_.c.parallelLineThreshold)return;(0,le.k0)(fe,(0,P.eR)(r),(0,P.eR)(o),(0,P.eR)(a),(0,P.eR)(t));const{spatialReference:c,pointer:l}=s,d=(0,P.al)(fe[0],fe[1],r[2]);if((0,A.Bb)(i,(0,Y.Rs)(d,c,O.jG,this.view))<this.squaredProximityThreshold(l)){if(this.isVertical(d,t,s)||this.isVertical(o,a,s))return;if(this._parallelToPreviousCandidate(e,n))return;n.push(new pe({referenceLine:e,lineStart:t,targetPoint:d,isDraped:"on-the-ground"===s.elevationInfo?.mode}))}}_parallelToPreviousCandidate(e,t){const r=e.left,i=e.right;for(const s of t)if((0,le.k0)(fe,(0,P.eR)(i),(0,P.eR)(s.constraint.start),(0,P.eR)(s.constraint.end),(0,P.eR)(r)),(0,b.bI)(fe,(0,P.eR)(i))<_.c.parallelLineThreshold)return s.addReferenceLine(e),!0;return!1}}const fe=(0,ue.Ue)();class ge extends se{snapNewVertex(e,t){const r=t.editGeometryOperations.data.components[0],i=[];if(r.vertices.length<2)return i;const{view:s}=this,n=(0,Y.Rs)(e,t.spatialReference,O.jG,s),o=r.vertices.at(-1);this._checkForSnappingCandidate(i,o.leftEdge,o,o.leftEdge.leftVertex,e,n,t);const a=r.vertices[0];return this._checkForSnappingCandidate(i,a.rightEdge,a,a.rightEdge.rightVertex,e,n,t),i}snapExistingVertex(e,t){const r=[],i=t.vertexHandle;if(i.component.vertices.length<3)return r;const{view:s}=this,n=(0,Y.Rs)(e,t.spatialReference,O.jG,s),o=i.leftEdge,a=i.rightEdge;if(o?.leftVertex.leftEdge){const i=o.leftVertex.leftEdge;this._checkForSnappingCandidate(r,i,i.rightVertex,i.leftVertex,e,n,t)}if(a?.rightVertex.rightEdge){const i=a.rightVertex.rightEdge;this._checkForSnappingCandidate(r,i,i.leftVertex,i.rightVertex,e,n,t)}return r}_checkForSnappingCandidate(e,t,r,i,s,n,o){if(!this.edgeExceedsShortLineThreshold(t,o))return;const a=this.view,c=(0,P.j7)(r.pos,a,o),l=(0,P.j7)(i.pos,a,o);this._checkForSnappingCandidateNormalized(e,l,c,s,n,o)}_checkForSnappingCandidateNormalized(e,t,r,i,s,n){this._projectionRay(me,t,r,i,n),this._checkForSnappingCandidateAlongProjectedRay(e,t,r,me,i,s,n)}_projectionRay(e,t,r,i,s){this._projectionRayGeodesic(e,t,r,i,s)||this._projectionRayPlanar(e,t,r)}_projectionRayGeodesic(e,t,r,i,s){let{spatialReference:n}=s;const o=(0,oe.n6)(t,r,n,n);if(null==o)return!1;const a=(0,oe.n6)(r,i,n,n);if(null==a)return!1;const c=Math.sign(re.c5.shortestSignedDiff(o,a))*Math.PI*.5,l=(0,ie.GJ)(o+c,"radians","geographic"),d=(0,x.Ue)(),u=(0,ae.FB)(r,i,n);return null!=u&&((0,oe.LH)(d,r,n,(0,ie.mE)(u,"meters"),l,"geodesic"),(0,E.f)(e,d,r),!0)}_projectionRayPlanar(e,t,r){const i=(0,b.$X)(ye,(0,P.eR)(r),(0,P.eR)(t));(0,E.s)(e,i[1],-i[0],0)}_checkForSnappingCandidateAlongProjectedRay(e,t,r,i,s,n,o){const{spatialReference:a,pointer:c}=o,l=(0,b.$X)(ye,(0,P.eR)(s),(0,P.eR)(r)),d=(0,b.AK)(i,l)/(0,b.we)(i),u=(0,b.od)(ye,(0,P.eR)(r),i,d),h=(0,P.al)(u[0],u[1],s[2]);if((0,A.Bb)(n,(0,Y.Rs)(h,a,O.jG,this.view))>this.squaredProximityThreshold(c)||this.isVertical(h,r,o)||this.isVertical(r,t,o))return;const p=(0,E.r)((0,x.Ue)(),r,i,Math.sign(d));e.push(new B({targetPoint:h,constraint:new T.aU(r,(0,P.uo)(p)),previousVertex:t,otherVertex:r,otherVertexType:U.CENTER,isDraped:"on-the-ground"===o.elevationInfo?.mode}))}}const ye=(0,ue.Ue)(),me=(0,x.Ue)();class ve extends k.j{constructor(e){let{targetPoint:t,point1:r,point2:i,isDraped:s}=e;super(t,new T.kt((0,P.uo)((0,E.m)((0,x.Ue)(),r,i,.5)),.5*(0,b.TE)((0,P.eR)(r),(0,P.eR)(i))),s,z.B.SELF),this._p1=r,this._p2=i}get hints(){return[new Z.w(A.ze.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new Z.w(A.ze.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new W.y(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}class Re extends se{snapNewVertex(e,t){const r=t.editGeometryOperations.data.components[0],i=[],s=r.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||s<2)return i;const{view:n}=this,o=r.vertices[0],a=r.vertices[s-1],c=(0,P.j7)(o.pos,n,t),l=(0,P.j7)(a.pos,n,t);return this._processCandidateProposal(c,l,e,t,i),i}snapExistingVertex(e,t){const r=[],i=t.vertexHandle,s=i.component;if(s.edges.length<2)return r;if("polyline"===t.editGeometryOperations.data.type&&(0===i.index||i.index===s.vertices.length-1))return r;const{view:n}=this,o=(0,P.j7)(i.leftEdge.leftVertex.pos,n,t),a=(0,P.j7)(i.rightEdge.rightVertex.pos,n,t);return this._processCandidateProposal(o,a,e,t,r),r}_processCandidateProposal(e,t,r,i,s){if(!this.exceedsShortLineThreshold(e,t,i))return;const n=(0,b.t7)(Se,(0,P.eR)(e),(0,P.eR)(t),.5),o=.5*(0,b.TE)((0,P.eR)(e),(0,P.eR)(t)),a=(0,le.xO)(Se,(0,P.eR)(r),n,o),c=(0,P.al)(a[0],a[1],r[2]),{spatialReference:l,pointer:d}=i,u=(0,Y.Rs)(r,l,O.jG,this.view);if((0,A.Bb)(u,(0,Y.Rs)(c,l,O.jG,this.view))<this.squaredProximityThreshold(d)){if(this.isVertical(e,c,i)||this.isVertical(c,t,i))return;s.push(new ve({targetPoint:c,point1:e,point2:t,isDraped:"on-the-ground"===i.elevationInfo?.mode}))}}}const Se=(0,ue.Ue)();let we=class extends c.Z{constructor(e){super(e),this.updating=!1,this._snappers=new n.Z,this._domain=z.B.SELF}initialize(){this._snappers.push(new _e(this.view,this.options),new de(this.view,this.options),new ge(this.view,this.options),new Re(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t,r){if(!(t&this._domain&&this.options.effectiveSelfEnabled))return[];const i=[];for(const s of this._snappers.items)for(const t of s.snap(e,r))i.push(t);return(0,A.lQ)(e,i),i}};function be(e,t){return[new we({view:e,options:t}),new X({view:e,options:t,spatialReference:e.spatialReference})]}(0,a._)([(0,l.Cb)({readOnly:!0})],we.prototype,"updating",void 0),(0,a._)([(0,l.Cb)({constructOnly:!0})],we.prototype,"view",void 0),(0,a._)([(0,l.Cb)()],we.prototype,"options",null),we=(0,a._)([(0,u.j)("esri.views.interactive.snapping.SelfSnappingEngine")],we);var Ee=r(90609);class xe extends k.j{constructor(e,t,r,i){super(e,new T.Hk(e),i,z.B.ALL),this.first=t,this.second=r}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Ee.w(this.targetPoint,this.isDraped,this.domain)]}}let Ce=class extends(ee.Z.EventedMixin(c.Z)){constructor(e){super(e),this.options=new y,this.snappingEnginesFactory=be,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=De.MAIN}initialize(){this.addHandles([(0,o.YP)((()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:r,distance:i,constraintsActive:s}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:r,distance:i,constraintsActive:s}}),(()=>{this.doneSnapping(),this.emit("changed")}),o.Z_),(0,o.YP)((()=>this.options),(e=>{for(const t of this._engines)t.options=e}),o.Z_),(0,o.YP)((()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory})),(e=>{let{viewReady:t,snappingEnginesFactory:r}=e;return this._recreateEngines(t,r)}),o.tX)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some((e=>e.updating))}_recreateEngines(e,t){if(this._destroyEngines(),!e)return;const{view:r,options:i}=this;this._engines=t(r,i)}_destroyEngines(){for(const e of this._engines)e.destroy();this._engines=[]}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,r=e*t;return r*r}get _squaredSatisfiesConstraintThreshold(){return _.c.satisfiesConstraintScreenThreshold*_.c.satisfiesConstraintScreenThreshold}snap(e){return function(e){return null!=e.scenePoint}(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:r}=e;this._removeVisualization();const i=this._currentMainCandidate;if(null==i)return t;const s=this._selectUpdateInput(e);if(null==s)return t;const{spatialReference:n}=r,o=(0,te.project)(s,n);if(null==o)return t;const{view:a}=this,{elevationInfo:c,visualizer:l}=r,d=[],u=(0,P.SN)(o,a,c),h=i.constraint.closestTo(u);if(!this._arePointsWithinScreenThreshold(u,h,r))return this._resetSnappingState(),t;i.targetPoint=h,d.push(...i.hints);for(const p of this._currentOtherActiveCandidates)p.targetPoint=h,d.push(...p.hints);return null!=l&&this.addHandles(l.draw(d,{spatialReference:n,elevationInfo:Te(r),view:a,selfSnappingZ:r.selfSnappingZ}),Oe),(0,P.aK)(h,a,t,r)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput(e){let{point:t,scenePoint:r}=e;switch(this._currentSnappedType){case De.MAIN:return t;case De.SCENE:return r}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=De.MAIN}_removeVisualization(){this.removeHandles(Oe)}async _snapSinglePoint(e){let{point:t,context:r,signal:i}=e;const{view:s}=this,{elevationInfo:n}=r,o=(0,P.SN)(t,s,n),a=await this._fetchCandidates(o,z.B.ALL,r,i);return this._createSnapResult(o,De.MAIN,a,s,t,r,i)}async _snapMultiPoint(e){let{point:t,scenePoint:r,context:i,signal:s}=e;const{view:n}=this,{coordinateHelper:o,elevationInfo:a,spatialReference:c}=i;await(0,te.initializeProjection)(r.spatialReference,c);const l=(0,te.project)(r,c),d=(0,P.SN)(l,n,a),u=await this._fetchCandidates(d,z.B.FEATURE,i,s);if(u.length>0){const e=await this._fetchCandidates(d,z.B.SELF,i,s);return this._createSnapResult(d,De.SCENE,[...u,...e],n,l,i,s)}const h=(0,P.SN)(t,n,a),p=await this._fetchCandidates(h,z.B.SELF,i,s);return this._createSnapResult(h,De.MAIN,p,n,{z:o.hasZ()&&t.hasZ?t.z??0:void 0,m:o.hasM()&&t.hasM?t.m??0:void 0},i,s)}async _fetchCandidates(e,t,r,i){return(await Promise.all(this._engines.map((s=>s.fetchCandidates(e,t,r,i))))).flat()}_createSnapResult(e,t,r,i,s,n,o){return{get valid(){return!(0,S.Hc)(o)},apply:()=>{const{spatialReference:o}=n,{snappedPoint:a,hints:c}=this._processCandidates(e,t,r,n);return this._removeVisualization(),null!=n.visualizer&&this.addHandles(n.visualizer.draw(c,{spatialReference:o,elevationInfo:O.jG,view:i,selfSnappingZ:n.selfSnappingZ}),Oe),(0,P.aK)(a,i,s,n)}}}_processCandidates(e,t,r,i){if(r.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),(0,A.lQ)(e,r);const s=this._currentMainCandidate;if(null!=s){const n=this._findOldConstraintInNewCandidates(s,r);if(n>=0){if(!(r[n]instanceof xe))return this._intersectWithOtherCandidates(n,r,e,t,i);if(this._arePointsWithinScreenThreshold(e,s.targetPoint,i))return this._updateSnappingCandidate(s,t,r,i)}}return this._intersectWithOtherCandidates(0,r,e,t,i)}_findOldConstraintInNewCandidates(e,t){return e instanceof xe?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}_intersectWithOtherCandidates(e,t,r,i,s){const{coordinateHelper:n}=s,o=t[e],a=[];for(let c=0;c<t.length;++c){if(c===e)continue;const i=t[c],s=o.constraint.intersect(i.constraint);if(s)for(const e of s.closestPoints(o.targetPoint))a.push([new xe(e,o,i,i.isDraped),this._squaredScreenDistance(r,e,n)])}return a.length>0&&(a.sort(((e,t)=>e[1]-t[1])),a[0][1]<this._squaredPointProximityThreshold(s.pointer))?this._updateSnappingCandidate(a[0][0],i,t,s):this.options.constraintsActive&&(o instanceof ne||o instanceof H.L||o instanceof B||o instanceof pe)?{snappedPoint:r,hints:[]}:this._updateSnappingCandidate(o,i,t,s)}_updateSnappingCandidate(e,t,r,i){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const s=this._currentMainCandidate.targetPoint,n=[];n.push(...e.hints);for(const o of r){if(e instanceof xe){if(o.constraint.equals(e.first.constraint)||o.constraint.equals(e.second.constraint))continue}else if(o.constraint.equals(e.constraint))continue;const t=o.constraint.closestTo(s);this._squaredScreenDistance(t,s,i.coordinateHelper)<this._squaredSatisfiesConstraintThreshold&&(o.targetPoint=s,this._currentOtherActiveCandidates.push(o),n.push(...o.hints))}return{snappedPoint:s,hints:n}}_squaredPointProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,r){return this._squaredScreenDistance(e,t,r.coordinateHelper)<this._squaredPointProximityThreshold(r.pointer)}_squaredScreenDistance(e,t,r){return(0,A.Bb)(this._toScreen(e,r),this._toScreen(t,r))}_toScreen(e,t){return(0,Y.Rs)(e,t.spatialReference,O.jG,this.view)}_findOldCandidateIndex(e,t){let r=-1;for(let i=0;i<e.length;++i)if(t.constraint.equals(e[i].constraint)){r=i;break}return r}get test(){return{visualizationsActive:this.hasHandles(Oe),engines:this._engines}}};var De;(0,a._)([(0,l.Cb)({constructOnly:!0})],Ce.prototype,"view",void 0),(0,a._)([(0,l.Cb)()],Ce.prototype,"options",void 0),(0,a._)([(0,l.Cb)({readOnly:!0})],Ce.prototype,"updating",null),(0,a._)([(0,l.Cb)()],Ce.prototype,"snappingEnginesFactory",void 0),(0,a._)([(0,l.Cb)()],Ce.prototype,"_engines",void 0),(0,a._)([(0,l.Cb)()],Ce.prototype,"_squaredMouseProximityThreshold",null),(0,a._)([(0,l.Cb)()],Ce.prototype,"_squaredTouchProximityThreshold",null),(0,a._)([(0,l.Cb)()],Ce.prototype,"_squaredSatisfiesConstraintThreshold",null),Ce=(0,a._)([(0,u.j)("esri.views.interactive.snapping.SnappingManager")],Ce),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(De||(De={}));const Oe="visualization-handle";function Te(e){let{coordinateHelper:t,elevationInfo:r}=e;return t.hasZ()?O.jG:r}const Pe=new Map;function je(e){if(!Pe.has(e)){const t=function(e,t){const r=new y({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:t?.distance??_.c.distance,touchSensitivityMultiplier:t?.touchSensitivityMultiplier??_.c.touchSensitivityMultiplier});return{...(0,o.YP)((()=>e.map?.allLayers?.toArray()??[]),(e=>{r.featureSources=new n.Z(e.map((e=>new p({layer:e,enabled:!0}))))}),o.nn),options:r}}(e,{distance:10}),r=function(e,t){return new Ce({view:e,options:t,snappingEnginesFactory:(t,r)=>[new X({view:e,spatialReference:e.spatialReference,options:r})]})}(e,t.options);Pe.set(e,{referenceCount:0,snappingManager:r,remove:()=>{t.remove(),r.destroy()}})}const t=Pe.get(e);t.referenceCount++;const r=(0,i.kB)((()=>function(e,t){t.referenceCount--,t.referenceCount>0||(0,s.Y)((()=>{0===t.referenceCount&&(t.remove(),Pe.delete(e))}))}(e,t)));return{snappingManager:t.snappingManager,...r}}},97760:(e,t,r)=>{r.d(t,{k:()=>a});var i=r(44179),s=r(34356),n=r(75691),o=r(53397);class a extends n.a{constructor(e){super({...e,isDraped:!0,constraint:new i.M8(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new o.w(s.ze.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},95905:(e,t,r)=>{r.d(t,{L:()=>a});var i=r(44179),s=r(34356),n=r(75691),o=r(53397);class a extends n.a{constructor(e){super({...e,constraint:new i.ku(e.edgeStart,e.edgeEnd)})}get hints(){return[new o.w(s.ze.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},75691:(e,t,r)=>{r.d(t,{a:()=>n});var i=r(80371),s=r(92605);class n extends s.j{constructor(e){let{targetPoint:t,objectId:r,constraint:s,isDraped:n}=e;super(t,s,n,i.B.FEATURE),this.objectId=r}}},92605:(e,t,r)=>{r.d(t,{j:()=>i});class i{constructor(e,t,r,i){this.targetPoint=e,this.constraint=t,this.isDraped=r,this.domain=i}}},11208:(e,t,r)=>{r.d(t,{CM:()=>l,RS:()=>d,Rs:()=>u});var i=r(17842),s=r(13611),n=r(32035),o=r(12400),a=r(55946),c=r(74509);function l(e,t,r,i){r.projectToRenderScreen(e,_),r.projectToRenderScreen(t,f),(0,s.$X)(i,f,_),(0,s.Fv)(i,i)}function d(e,t,r,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,o.Ue)();const a=(0,n.c)(p,e);return a[2]=(0,c.zx)(i,a,t,r)||0,i.renderCoordsHelper.toRenderCoords(a,t,s),s}function u(e,t,r,s){return"2d"===s.type?(h.x=e[0],h.y=e[1],h.spatialReference=t,s.toScreen(h)):(d(e,t,r,s,p),s.state.camera.projectToScreen(p,g),(0,i.vW)(g[0],g[1]))}const h=(0,a.T)(0,0,0,null),p=(0,o.Ue)(),_=(0,i.gX)(),f=(0,i.gX)(),g=(0,i.s1)()},30541:(e,t,r)=>{r.d(t,{FB:()=>h,RT:()=>u});r(59486);var i=r(47898),s=r(12400),n=r(2170);r(32035),r(96334);(0,s.Ue)();var o=r(94393),a=r(15559),c=r(92975),l=r(47072),d=r(78952);function u(e,t){if(!(0,c.fS)(e.spatialReference,t.spatialReference))return null;const{spatialReference:r}=e;return y[0]=e.x,y[1]=e.y,y[2]=e.hasZ?e.z:0,m[0]=t.x,m[1]=t.y,m[2]=t.hasZ?t.z:0,h(y,m,r)}function h(e,t,r){return(0,l.T)(r,p,_,f,e,t,r)}function p(e,t,r){return(0,i.yG)((0,a.cA)(g,e,t,r).distance,"meters")}function _(e,t,r){return(0,i.yG)((0,n.geodesicLength)(function(e,t,r){return{type:"polyline",spatialReference:r,paths:[[[...e],[...t]]]}}(e,t,r),"meters"),"meters")}function f(e,t,r){return(0,o.k)(e,r,v)&&(0,o.k)(t,r,R)?(0,i.yG)((0,a.cA)(g,v,R,d.Z.WGS84).distance,"meters"):null}const g=new a._q,y=(0,s.Ue)(),m=(0,s.Ue)(),v=(0,s.Ue)(),R=(0,s.Ue)()},47072:(e,t,r)=>{r.d(t,{T:()=>n,Y:()=>o});var i=r(15559),s=r(92975);function n(e,t,r,n){for(var o=arguments.length,a=new Array(o>4?o-4:0),c=4;c<o;c++)a[c-4]=arguments[c];return(0,s.sT)(e)&&(0,i.Gb)(e)?t.apply(void 0,a):(0,s.sS)(e)?r.apply(void 0,a):n.apply(void 0,a)}const o=1e5}}]);
//# sourceMappingURL=60795.66132bcf.chunk.js.map