"use strict";(self.webpackChunkn2_compile=self.webpackChunkn2_compile||[]).push([[319],{50319:(e,t,n)=>{n.r(t),n.d(t,{default:()=>_});var o=n(27366),s=n(66978),i=(n(32718),n(93169),n(84936),n(10064),n(69912)),d=n(32035),c=n(12400),r=n(85981),a=n(23470),u=n(78329),h=n(79762);function p(e,t,n){const o=(0,a.c)(),s=(0,a.g)(o);return(0,d.r)(s,s,e,.5),(0,d.r)(s,s,t,.5),o[3]=(0,d.p)(s,e),(0,d.g)(s,s,n),o}let g=class{constructor(){this._idToComponent=new Map,this._components=new u.Z((e=>e.bounds)),this._edges=new u.Z((e=>e.bounds)),this._tmpLineSegment=(0,r.Ue)(),this._tmpP1=(0,c.Ue)(),this._tmpP2=(0,c.Ue)(),this._tmpP3=(0,c.Ue)(),this.remoteClient=null}async fetchCandidates(e,t){await Promise.resolve(),(0,s.k_)(t),await this._ensureEdgeLocations(e,t);const n=[];return this._edges.forEachNeighbor((t=>(this._addCandidates(e,t,n),n.length<1e3)),e.bounds),{result:{candidates:n}}}async _ensureEdgeLocations(e,t){const n=[];if(this._components.forEachNeighbor((e=>{if(null==e.info){const{id:t,uid:o}=e;n.push({id:t,uid:o})}return!0}),e.bounds),!n.length)return;const o={components:n},s=await this.remoteClient.invoke("fetchAllEdgeLocations",o,t??{});for(const i of s.components)this._setFetchEdgeLocations(i)}async add(e){const t=new l(e.id,e.bounds);return this._idToComponent.set(t.id,t),this._components.add([t]),{result:{}}}async remove(e){const t=this._idToComponent.get(e.id);if(t){const e=[];this._edges.forEachNeighbor((n=>(n.component===t&&e.push(n),!0)),t.bounds),this._edges.remove(e),this._components.remove([t]),this._idToComponent.delete(t.id)}return{result:{}}}_setFetchEdgeLocations(e){const t=this._idToComponent.get(e.id);if(null==t||e.uid!==t.uid)return;const n=h.n_.createView(e.locations),o=new Array(n.count),s=(0,c.Ue)(),i=(0,c.Ue)();for(let c=0;c<n.count;c++){n.position0.getVec(c,s),n.position1.getVec(c,i);const d=p(s,i,e.origin),r=new f(t,c,d);o[c]=r}this._edges.add(o);const{objectIds:d,origin:r}=e;t.info={locations:n,objectIds:d,origin:r}}_addCandidates(e,t,n){const{info:o}=t.component,{origin:s,objectIds:i}=o,c=o.locations,r=c.position0.getVec(t.index,this._tmpP1),a=c.position1.getVec(t.index,this._tmpP2);(0,d.g)(r,r,s),(0,d.g)(a,a,s);const u=i[c.componentIndex.get(t.index)];this._addEdgeCandidate(e,u,r,a,n),m(e,u,r,n),m(e,u,a,n)}_addEdgeCandidate(e,t,n,o,s){if(!e.returnEdge)return;const i=(0,a.g)(e.bounds),u=(0,r.zk)(n,o,this._tmpLineSegment),h=(0,r.nF)(u,i,this._tmpP3);(0,a.n)(e.bounds,h)&&s.push({type:"edge",objectId:t,target:(0,c.d9)(h),distance:(0,d.p)(i,h),start:(0,c.d9)(n),end:(0,c.d9)(o)})}};g=(0,o._)([(0,i.j)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],g);const _=g;function m(e,t,n,o){if(!e.returnVertex||!(0,a.n)(e.bounds,n))return;const s=(0,a.g)(e.bounds);o.push({type:"vertex",objectId:t,target:(0,c.d9)(n),distance:(0,d.p)(s,n)})}class l{constructor(e,t){this.id=e,this.bounds=t,this.info=null,this.uid=++l.uid}}l.uid=0;class f{constructor(e,t,n){this.component=e,this.index=t,this.bounds=n}}}}]);
//# sourceMappingURL=319.1d5c0d6d.chunk.js.map