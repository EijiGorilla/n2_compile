"use strict";(self.webpackChunkn2_compile=self.webpackChunkn2_compile||[]).push([[26823],{36700:(e,t,n)=>{n.d(t,{x:()=>s});var i=n(44179),a=n(75691),o=n(61309);class s extends a.a{constructor(e){super({...e,constraint:new i.Hk(e.targetPoint)})}get hints(){return[new o.n(this.targetPoint,this.isDraped,this.domain)]}}},26823:(e,t,n)=>{n.r(t),n.d(t,{FeatureCollectionSnappingSource:()=>f});var i=n(27366),a=n(7138),o=n(97942),s=n(66978),r=n(94172),c=n(49861),l=(n(93169),n(32718),n(84936),n(69912)),u=n(74509),d=n(34356),p=n(52824),h=n(59877),g=n(53580),y=n(48817);let f=class extends a.Z{get availability(){return 1}get updating(){return this.layerSource.updating}get _snappingElevationAligner(){const{view:e}=this,{layer:t}=this.layerSource,n=null!=e&&"3d"===e.type;if(!n||"subtype-group"===t.type)return(0,h.p)();return(0,h.p)(n,{elevationInfo:t.elevationInfo,alignPointsInFeatures:async(n,i)=>(await(0,s.Hl)(e.whenLayerView(t),i)).elevationAlignPointsInFeatures(n,i)})}get _snappingElevationFilter(){const{view:e}=this,t=null!=e&&"3d"===e.type&&"subtype-group"!==this.layerSource.layer.type;return(0,g.c)(t)}get _symbologySnappingFetcher(){const{view:e}=this,{layer:t}=this.layerSource;return null!=e&&"3d"===e.type&&"subtype-group"!==t.type?(0,y.k)(this._symbologySnappingSupported,(async(n,i)=>{const a=await e.whenLayerView(t);return(0,s.k_)(i),a.queryForSymbologySnapping({candidates:n,spatialReference:e.spatialReference},i)})):(0,y.k)()}get _symbologySnappingSupported(){return null!=this._layerView3D&&this._layerView3D.symbologySnappingSupported}initialize(){const{view:e}=this,{layer:t}=this.layerSource;null!=e&&"3d"===e.type&&"subtype-group"!==t.type&&(e.whenLayerView(t).then((e=>this._layerView3D=e)),this.addHandles([e.elevationProvider.on("elevation-change",(e=>{let{context:n}=e;const{elevationInfo:i}=t;(0,u.W_)(n,i)&&this._snappingElevationAligner.notifyElevationSourceChange()})),(0,r.YP)((()=>t.elevationInfo),(()=>this._snappingElevationAligner.notifyElevationSourceChange()),r.nn),(0,r.YP)((()=>null!=this._layerView3D?this._layerView3D.processor?.renderer:null),(()=>this._symbologySnappingFetcher.notifySymbologyChange()),r.nn),(0,r.on)((()=>this._layerView3D?.layer),["edits","apply-edits","graphic-update"],(()=>this._symbologySnappingFetcher.notifySymbologyChange()))]))}constructor(e){super(e),this.view=null,this._layerView3D=null,this._memoizedMakeGetGroundElevation=(0,o.H)(p.g)}refresh(){}async fetchCandidates(e,t){const{layer:n}=this.layerSource,i=n.source;if(!i?.querySnapping)return[];const a=(0,d.ML)(n),o=(0,d.rh)(e,this.view?.type??"2d",a),r=await i.querySnapping(o,{signal:t});(0,s.k_)(t);const c=e.coordinateHelper.spatialReference,l=await this._snappingElevationAligner.alignCandidates(r.candidates,c,t);(0,s.k_)(t);const u=await this._symbologySnappingFetcher.fetch(l,t);(0,s.k_)(t);const h=0===u.length?l:[...l,...u],g=this._snappingElevationFilter.filter(o,h),y=this._memoizedMakeGetGroundElevation(this.view,c);return g.map((e=>(0,p.X)(e,y)))}};(0,i._)([(0,c.Cb)({constructOnly:!0})],f.prototype,"layerSource",void 0),(0,i._)([(0,c.Cb)({constructOnly:!0})],f.prototype,"view",void 0),(0,i._)([(0,c.Cb)()],f.prototype,"_snappingElevationAligner",null),(0,i._)([(0,c.Cb)()],f.prototype,"_snappingElevationFilter",null),(0,i._)([(0,c.Cb)()],f.prototype,"_symbologySnappingFetcher",null),(0,i._)([(0,c.Cb)()],f.prototype,"_layerView3D",void 0),(0,i._)([(0,c.Cb)()],f.prototype,"_symbologySnappingSupported",null),f=(0,i._)([(0,l.j)("esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource")],f)},52824:(e,t,n)=>{n.d(t,{X:()=>c,g:()=>l});var i=n(38054),a=n(97760),o=n(95905),s=n(36700);function r(e){let{x:t,y:n,z:a}=e;return(0,i.al)(t,n,a??0)}function c(e,t){switch(e.type){case"edge":return e.draped?new a.k({edgeStart:r(e.start),edgeEnd:r(e.end),targetPoint:r(e.target),objectId:e.objectId,getGroundElevation:t}):new o.L({edgeStart:r(e.start),edgeEnd:r(e.end),targetPoint:r(e.target),objectId:e.objectId,isDraped:!1});case"vertex":return new s.x({targetPoint:r(e.target),objectId:e.objectId,isDraped:!1})}}function l(e,t){return null!=e&&"3d"===e.type?(n,i)=>e.elevationProvider.getElevation(n,i,0,t,"ground"):()=>null}},59877:(e,t,n)=>{n.d(t,{p:()=>c});n(93169);var i=n(16054),a=n(77427),o=n(66978),s=n(68860),r=n(88152);function c(){let e=arguments.length>1?arguments[1]:void 0;if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]){const{elevationInfo:t,alignPointsInFeatures:n}=e;return new u(t,n)}return new l}class l{async alignCandidates(e,t,n){return e}notifyElevationSourceChange(){}}class u{constructor(e,t){this._elevationInfo=e,this._alignPointsInFeatures=t,this._alignmentsCache=new i.z(1024),this._cacheVersion=0}async alignCandidates(e,t,n){const i=this._elevationInfo;return null==i||"absolute-height"!==i.mode||i.featureExpressionInfo?this._alignComputedElevationCandidates(e,t,n):(this._alignAbsoluteElevationCandidates(e,t,i),e)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}_alignAbsoluteElevationCandidates(e,t,n){const{offset:i,unit:a}=n;if(null==i)return;const o=(0,s._R)(t),c=i*((0,r.Z7)(a??"meters")/o);for(const s of e)switch(s.type){case"edge":s.start.z+=c,s.end.z+=c;continue;case"vertex":s.target.z+=c;continue}}async _alignComputedElevationCandidates(e,t,n){const i=new Map;for(const o of e)(0,a.s1)(i,o.objectId,h).push(o);const[s,r,c]=this._prepareQuery(i,t),l=await this._alignPointsInFeatures(s,n);if((0,o.k_)(n),c!==this._cacheVersion)return this._alignComputedElevationCandidates(e,t,n);this._applyCacheAndResponse(s,l,r);const{drapedObjectIds:u,failedObjectIds:d}=l,p=[];for(const a of e){const{objectId:e}=a;u.has(e)&&"edge"===a.type&&(a.draped=!0),d.has(e)||p.push(a)}return p}_prepareQuery(e,t){const n=[],i=[];for(const[a,o]of e){const e=[];for(const t of o)this._addToQueriesOrCachedResult(a,t.target,e,i),"edge"===t.type&&(this._addToQueriesOrCachedResult(a,t.start,e,i),this._addToQueriesOrCachedResult(a,t.end,e,i));0!==e.length&&n.push({objectId:a,points:e})}return[{spatialReference:t.toJSON(),pointsInFeatures:n},i,this._cacheVersion]}_addToQueriesOrCachedResult(e,t,n,i){const a=p(e,t),o=this._alignmentsCache.get(a);null==o?n.push(t):i.push(new d(t,o))}_applyCacheAndResponse(e,t,n){let{elevations:i,drapedObjectIds:a,failedObjectIds:o}=t;for(const c of n)c.apply();let s=0;const r=this._alignmentsCache;for(const{objectId:c,points:l}of e.pointsInFeatures){if(o.has(c)){s+=l.length;continue}const e=!a.has(c);for(const t of l){const n=p(c,t),a=i[s++];t.z=a,e&&r.put(n,a,1)}}}}class d{constructor(e,t){this.point=e,this.z=t}apply(){this.point.z=this.z}}function p(e,t){let{x:n,y:i,z:a,spatialReference:o}=t;return`${e}-${n}-${i}-${a??0}}-wkid:${o?.wkid}`}function h(){return[]}},53580:(e,t,n)=>{n.d(t,{c:()=>s});n(93169);class i{filter(e,t){return t}notifyElevationSourceChange(){}}class a{filter(e,t){const{point:n,distance:i}=e,{z:a}=n;if(null==a)return t;if(0===t.length)return t;const s=function(e){return"number"==typeof e?{x:e,y:e,z:e}:e}(i),r=this._updateCandidatesTo3D(t,n,s).filter(o);return r.sort(l),r}_updateCandidatesTo3D(e,t,n){for(const i of e)switch(i.type){case"edge":r(i,t,n);continue;case"vertex":c(i,t,n);continue}return e}}function o(e){return e.distance<=1}function s(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?new a:new i}function r(e,t,n){let{x:i,y:a,z:o}=n;const{start:s,end:r,target:c}=e;e.draped||function(e,t,n,i){const a=i.x-n.x,o=i.y-n.y,s=i.z-n.z,r=a*a+o*o+s*s,c=(t.x-n.x)*a+(t.y-n.y)*o+s*(t.z-n.z),l=Math.min(1,Math.max(0,c/r)),u=n.x+a*l,d=n.y+o*l,p=n.z+s*l;e.x=u,e.y=d,e.z=p}(c,t,s,r);const l=(t.x-c.x)/i,u=(t.y-c.y)/a,d=(t.z-c.z)/o;e.distance=Math.sqrt(l*l+u*u+d*d)}function c(e,t,n){let{x:i,y:a,z:o}=n;const{target:s}=e,r=(t.x-s.x)/i,c=(t.y-s.y)/a,l=(t.z-s.z)/o,u=Math.sqrt(r*r+c*c+l*l);e.distance=u}function l(e,t){return e.distance-t.distance}},48817:(e,t,n)=>{n.d(t,{k:()=>r});n(93169);var i=n(84652),a=n(16054),o=n(66978),s=n(643);function r(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?new l(arguments.length>1?arguments[1]:void 0):new c}class c{async fetch(){return[]}notifySymbologyChange(){}}class l{constructor(e){this._getSymbologyCandidates=e,this._candidatesCache=new a.z(1024),this._cacheVersion=0}async fetch(e,t){if(0===e.length)return[];const n=[],a=[],s=this._candidatesCache;for(const o of e){const e=u(o),t=s.get(e);if(t)for(const n of t)a.push((0,i.d9)(n));else n.push(o),s.put(e,[],1)}if(0===n.length)return a;const r=this._cacheVersion,{candidates:c,sourceCandidateIndices:l}=await this._getSymbologyCandidates(n,t);if((0,o.k_)(t),r!==this._cacheVersion)return this.fetch(e,t);const d=[],{length:p}=c;for(let o=0;o<p;++o){const e=c[o],t=u(n[l[o]]),a=s.get(t);a.push(e),s.put(t,a,a.length),d.push((0,i.d9)(e))}return a.concat(d)}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function u(e){switch(e.type){case"vertex":{const{objectId:t,target:n}=e,i=`${t}-vertex-${n.x}-${n.y}-${n.z??0}`;return(0,s.hP)(i).toString()}case"edge":{const{objectId:t,start:n,end:i}=e,a=`${t}-edge-${n.x}-${n.y}-${n.z??0}-to-${i.x}-${i.y}-${i.z??0}`;return(0,s.hP)(a).toString()}default:return""}}}}]);
//# sourceMappingURL=26823.3ed5a617.chunk.js.map