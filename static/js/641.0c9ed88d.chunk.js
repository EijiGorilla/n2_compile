"use strict";(self.webpackChunkn2_compile=self.webpackChunkn2_compile||[]).push([[641],{10641:(e,t,i)=>{i.r(t),i.d(t,{CIMSymbolRasterizer:()=>o});var h=i(82272),s=i(51e3);class r{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(e){return this._resourceMap.get(e)??null}async fetchResource(e,t){const i=this._resourceMap.get(e);if(i)return{width:i.width,height:i.height};let h=this._inFlightResourceMap.get(e);return h?h.then((e=>({width:e.width,height:e.height}))):(h=(0,s.n$)(e,t),this._inFlightResourceMap.set(e,h),h.then((t=>(this._inFlightResourceMap.delete(e),this._resourceMap.set(e,t),{width:t.width,height:t.height})),(()=>({width:0,height:0}))))}deleteResource(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}loadFont(e){return(0,h.mx)(e)}}var a=i(33795),n=i(94457),c=i(26707),l=i(31027);class o{constructor(e){this._spatialReference=e,this._imageDataCanvas=null,this._cimResourceManager=new r}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,i,h,s,r,a,o,u){if(!e)return null;const{data:d}=e;if(!d||"CIMSymbolReference"!==d.type||!d.symbol)return null;const{symbol:y}=d;r||(r=(0,l.JW)(y));const m=await c.E.resolveSymbolOverrides(d,t,this._spatialReference,s,r,a,o),w=this._cimResourceManager,p=[];n.B$.fetchResources(m,w,p),n.B$.fetchFonts(m,w,p),p.length>0&&await Promise.all(p);const{width:M,height:_}=i,R=g(r,M,_,h),b=n.B$.getEnvelope(m,R,w);if(!b)return null;b.x===1/0&&(b.x=M+2),b.y===1/0&&(b.y=-_/2),b.width===-1/0&&(b.width=M),b.height===-1/0&&(b.height=_);let f=1,v=0,C=0;switch(y.type){case"CIMPointSymbol":case"CIMTextSymbol":{let e=1;b.width>M&&(e=M/b.width);let t=1;b.height>_&&(t=_/b.height),"preview"===h&&(b.width<M&&(e=M/b.width),b.height<_&&(t=_/b.height)),f=Math.min(e,t),v=b.x+b.width/2,C=b.y+b.height/2}break;case"CIMLineSymbol":{(u||b.height>_)&&(f=_/b.height),C=b.y+b.height/2;const e=b.x*f+M/2,t=(b.x+b.width)*f+M/2,{paths:i}=R;i[0][0][0]-=e/f,i[0][2][0]-=(t-M)/f}break;case"CIMPolygonSymbol":{v=b.x+b.width/2,C=b.y+b.height/2;const e=b.x*f+M/2,t=(b.x+b.width)*f+M/2,i=b.y*f+_/2,h=(b.y+b.height)*f+_/2,{rings:s}=R;e<0&&(s[0][0][0]-=e,s[0][3][0]-=e,s[0][4][0]-=e),i<0&&(s[0][0][1]+=i,s[0][1][1]+=i,s[0][4][1]+=i),t>M&&(s[0][1][0]-=t-M,s[0][2][0]-=t-M),h>_&&(s[0][2][1]+=h-_,s[0][3][1]+=h-_)}}const x={type:"cim",data:{type:"CIMSymbolReference",symbol:m}};return this.rasterize(x,M,_,v,C,f,r,1,R)}rasterize(e,t,i,h,s,r,n){let c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;const{data:u}=e;if(!u||"CIMSymbolReference"!==u.type||!u.symbol)return null;const{symbol:d}=u,y=this._canvas,m=1.3333333333333333*(window.devicePixelRatio||1);y.width=t*m,y.height=i*m,n||(n=(0,l.JW)(d)),o||(o=g(n,t,i,"legend")),y.width+=2*c,y.height+=2*c;const w=y.getContext("2d",{willReadFrequently:!0}),p=a.zA.createIdentity();return p.translate(-h,-s),p.scale(r*m,-r*m),p.translate(t*m/2+c,i*m/2+c),w.clearRect(0,0,y.width,y.height),new a.cD(w,this._cimResourceManager,p,!0).drawSymbol(d,o),w.getImageData(0,0,y.width,y.height)}}function g(e,t,i,h){const s=-t/2+1,r=t/2-1,a=i/2-1,n=-i/2+1;switch(e){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[s,0],[0,0],[r,0]]]};default:return"legend"===h?{rings:[[[s,a],[r,0],[r,n],[s,n],[s,a]]]}:{rings:[[[s,a],[r,a],[r,n],[s,n],[s,a]]]}}}}}]);
//# sourceMappingURL=641.0c9ed88d.chunk.js.map