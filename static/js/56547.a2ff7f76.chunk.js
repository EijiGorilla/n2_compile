"use strict";(self.webpackChunkn2_compile=self.webpackChunkn2_compile||[]).push([[56547],{56547:(t,e,r)=>{r.r(e),r.d(e,{default:()=>m});var a=r(63780),n=r(18722),o=r(68700),f=r(50894),u=r(32035),s=r(93311),i=r(78952),l=r(50628),b=r(74432),p=r(89414);class c{transform(t){const e=this._transform(t),r=[e.points.buffer,e.rgb.buffer];null!=e.pointIdFilterMap&&r.push(e.pointIdFilterMap.buffer);for(const a of e.attributes)"buffer"in a.values&&(0,n.eP)(a.values.buffer)&&a.values.buffer!==e.rgb.buffer&&r.push(a.values.buffer);return Promise.resolve({result:e,transferList:r})}_transform(t){const e=(0,b.Ym)(t.schema,t.geometryBuffer);let r=e.length/3,n=null;const o=new Array,f=(0,b.dH)(t.primaryAttributeData,e,r);null!=t.primaryAttributeData&&f&&o.push({attributeInfo:t.primaryAttributeData.attributeInfo,values:f});const u=(0,b.dH)(t.modulationAttributeData,e,r);null!=t.modulationAttributeData&&u&&o.push({attributeInfo:t.modulationAttributeData.attributeInfo,values:u});let s=(0,b.aE)(t.rendererInfo,f,u,r);if(t.filterInfo&&t.filterInfo.length>0&&null!=t.filterAttributesData){const f=t.filterAttributesData.filter(a.pC).map((t=>{const a=(0,b.dH)(t,e,r),n={attributeInfo:t.attributeInfo,values:a};return o.push(n),n}));n=new Uint32Array(r),r=(0,b.hv)(e,s,n,t.filterInfo,f)}for(const a of t.userAttributesData){const t=(0,b.dH)(a,e,r);o.push({attributeInfo:a.attributeInfo,values:t})}3*r<s.length&&(s=new Uint8Array(s.buffer.slice(0,3*r))),this._applyElevationOffsetInPlace(e,r,t.elevationOffset);const l=this._transformCoordinates(e,r,p.Oo.fromData(t.obbData),i.Z.fromJSON(t.inSR),i.Z.fromJSON(t.outSR));return{obbData:t.obbData,points:l,rgb:s,attributes:o,pointIdFilterMap:n}}_transformCoordinates(t,e,r,a,n){if(!(0,l.projectBuffer)(t,a,0,t,n,0,e))throw new Error("Can't reproject");const f=(0,s.d9)(r.center),i=(0,s.Ue)(),b=(0,s.Ue)(),p=(0,s.d9)(r.halfSize);(0,o.Kx)(h,r.quaternion);const c=new Float32Array(3*e);for(let o=0;o<e;o++){let e=3*o;i[0]=t[e]-f[0],i[1]=t[e+1]-f[1],i[2]=t[e+2]-f[2],(0,u.u)(b,i,h),p[0]=Math.max(p[0],Math.abs(b[0])),p[1]=Math.max(p[1],Math.abs(b[1])),p[2]=Math.max(p[2],Math.abs(b[2])),c[e++]=i[0],c[e++]=i[1],c[e]=i[2]}return r.halfSize=p,c}_applyElevationOffsetInPlace(t,e,r){if(0!==r)for(let a=0;a<e;a++)t[3*a+2]+=r}}const h=(0,f.Ue)();function m(){return new c}}}]);
//# sourceMappingURL=56547.a2ff7f76.chunk.js.map